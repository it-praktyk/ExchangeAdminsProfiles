<#

	.DESCRIPTION
	PowerShell profile for Exchange Servers which can't directly connect to internet
	More information in the article "Configuring Exchange Servers Without Internet Access" 
	http://blogs.technet.com/b/exchange/archive/2010/05/14/3409948.aspx
	or 
	"How Certificate Revocation Works"
	http://technet.microsoft.com/en-us/library/ee619754%28v=ws.10%29.aspx

   
	This profile need to be copied to all Exchange servers as a file
	C:\Windows\System32\WindowsPowerShell\v1.0\Microsoft.PowerShell_profile.ps1 .
	
	.NOTES
	AUTHOR: Wojciech Sciesinski, wojciech[at]sciesinski[dot]net
	KEYWORDS: Exchange, PowerShell
	VERSION HISTORY
	0.1 - 2015-03-08 - the first version publishied on GitHub

	
	DISCLAIMER
	This script is provided AS IS without warranty of any kind. I disclaim all implied warranties including, without limitation,
	any implied warranties of merchantability or of fitness for a particular purpose. The entire risk arising out of the use or
	performance of the sample scripts and documentation remains with you. In no event shall I be liable for any damages whatsoever
	(including, without limitation, damages for loss of business profits, business interruption, loss of business information,
	or other pecuniary loss) arising out of the use of or inability to use the script or documentation. 

#>

	$key1Path = "HKCU:\Software\Microsoft\Windows\CurrentVersion\WinTrust\Trust Providers\Software Publishing"
	$key1 = Get-ItemProperty -Path $key1Path -Name State 


	$key2Path = "HKCU:\Software\Microsoft\Windows\CurrentVersion\Internet Settings"
	$key2 = Get-ItemProperty -Path $key2Path  -Name CertificateRevocation

	If ($key1.state -ne 146944) {

		Set-ItemProperty -Path $key1Path -Name State -Value 146944 -Force

	}


	If ($key2.CertificateRevocation -ne 0) {

		Set-ItemProperty -Path $key2Path -Name CertificateRevocation -Value 0 -Force

	}